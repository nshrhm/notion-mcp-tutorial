# Notion MCP API 利用ガイドラインとヒント

## Notion APIの概要とMCPサーバー
Notionは豊富なAPIを提供しており、`notionApi` MCPサーバーを通じてこれらの機能の多くを利用できます。ただし、APIにはレート制限などの一般的な制限が存在するほか、特定の操作はUIで行う方が効率的な場合もあります。

## 主要な利用可能API機能 (例)
`notionApi` MCPサーバーを通じて、以下のような多様な操作が可能です。

- **情報取得:**
    - `API-get-self`: 自分のボットユーザー情報を取得
    - `API-post-search`: ページやデータベースをタイトルで検索
    - `API-post-database-query`: データベースの内容を条件で絞り込んで取得
    - `API-retrieve-a-page`: 特定のページ情報を取得
    - `API-retrieve-a-database`: 特定のデータベース情報を取得
    - `API-get-block-children`: 特定のブロック（ページ含む）の子ブロックを取得
- **コンテンツ作成・更新:**
    - `API-post-page`: 新しいページを作成
    - `API-create-a-database`: 新しいデータベースを作成 (基本的なプロパティ定義が必要)
    - `API-patch-page`: ページのプロパティ（タイトル、アイコン等）やアーカイブ状態を更新
    - `API-update-a-database`: データベースのタイトルやプロパティ定義を更新
    - `API-patch-block-children`: ブロック（ページ含む）に子ブロックを追加
    - `API-update-a-block`: 既存ブロックの内容（テキスト等）や状態（チェックボックス等）を更新
    - `API-delete-a-block`: ブロックを削除
- **コメント:**
    - `API-create-a-comment`: ページやブロックにコメントを追加
    - `API-retrieve-a-comment`: コメントを取得

**注意:** 上記は一部です。利用可能な全ツールと詳細は、システムプロンプトのMCPサーバーセクションを参照してください。

## 推奨されるアプローチ: UIとAPIのハイブリッド活用
APIを使えば多くの操作を自動化できますが、特に複雑なデータベース構造の設計や、ページの初期レイアウト作成などは、Notionの直感的なUIで行う方が効率的な場合があります。

**ハイブリッドアプローチの例:**

1.  **UIでの準備:**
    *   データベースを作成し、プロパティ（列）を定義する。
    *   ページのテンプレートを作成する。
    *   基本的な構造や初期データを設定する。
2.  **APIでの操作:**
    *   `API-post-search` や `API-post-database-query` で必要な情報（ページID、データベースIDなど）を取得する。
    *   `API-post-page` でテンプレートから新しいページを作成したり、`API-patch-block-children` で既存ページにコンテンツを追加する。
    *   `API-create-a-comment` で進捗やメモを記録する。
    *   定期的なデータ更新や取得を自動化する。

**コメント機能の活用例:**
ページやデータベース自体を直接更新する代わりに、コメント機能を使って変更履歴や追加情報を記録するのも有効な方法です。
```typescript
// 特定のページにコメントを追加して情報を記録
<use_mcp_tool>
<server_name>notionApi</server_name>
<tool_name>API-create-a-comment</tool_name>
<arguments>
{
  "parent": {
    "page_id": "YOUR_PAGE_ID" // 対象ページのIDを指定
  },
  "rich_text": [
    {
      "text": {
        "content": "更新情報（YYYY-MM-DD）: プロジェクトのステータスを「完了」に変更しました。"
      }
    }
  ]
}
</arguments>
</use_mcp_tool>
```

## ベストプラクティス

1.  **APIドキュメントの参照:** Notionの公式APIドキュメントや、MCPサーバーが提供するツールのスキーマを確認し、各APIの詳細なパラメータや制限事項を理解しましょう。
2.  **権限設定の確認:** インテグレーションに必要な権限が付与されているか、対象ページ/データベースにインテグレーションが接続されているかを確認してください。
3.  **エラーハンドリング:** API呼び出しは失敗する可能性があります。`try...catch` などを用いて適切にエラーを処理し、必要に応じてリトライやユーザーへの通知を行うようにしましょう。特にレート制限（短時間に多くのリクエストを送ると発生）には注意が必要です。
4.  **IDの取得と管理:** ページやデータベース、ブロックをAPIで操作するには、それぞれのIDが必要です。`API-post-search` や `API-post-database-query` などで取得したIDを適切に管理・利用してください。

## 開発者向けガイドライン

1.  **実装の確認:**
    *   利用したいAPIツールがMCPサーバーで提供されているか確認する。
   - 機能の動作テスト
   - エラーケースの検証

2. ドキュメント管理
   - API仕様の定期確認
   - 制限事項の更新
   - ユーザーへの通知

3. エラーハンドリング
   - 適切なエラーメッセージ
   - 代替フローの提供
   - ユーザーガイダンス

## 次のステップ
現在の制限事項を理解した上で、利用可能な機能を最大限活用するアプローチを検討してください。必要に応じて、UIとAPIを組み合わせたハイブリッドなソリューションを検討することをお勧めします。
